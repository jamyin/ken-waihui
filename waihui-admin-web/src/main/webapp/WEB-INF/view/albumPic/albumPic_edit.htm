<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Form Elements - Ace Admin</title>
		<meta name="description" content="Common form elements and layouts" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<#include "../common/head.htm"/>

		<link href="${base}/plugins/uploadify/uploadify.css" rel="stylesheet" type="text/css" />
		<!-- <script type="text/javascript" src="${base}/plugins/uploadify/jquery-1.3.2.min.js"></script> -->
 		<script type="text/javascript" src="${base}/plugins/uploadify/swfobject.js"></script>
		<script type="text/javascript" src="${base}/plugins/uploadify/jquery.uploadify.v2.1.4.min.js"></script>			
		
	</head>
	<body>
		<div class="container-fluid" id="main-container">
			<div id="main-content" class="clearfix" style="margin-left:0px;">
					<div id="page-content" class="clearfix">
						<div class="row-fluid">
							<!-- PAGE CONTENT BEGINS HERE -->
							<form id="submitForm" class="form-horizontal" method="POST">
								<input type="hidden" id="id" name="id" value="${(trainNewsInfo.id)!}"/>
								<input type="hidden" id="marked" name="marked" value="${(trainNewsInfo.marked)!}""/>
								<input type="hidden" id="microPic" name="microPic" value=""/>
								<input type="hidden" name="thumbnail" value="${(trainNewsInfo.microPic)!}"/>
								<input type="hidden" id="content" name="content" value=""/>
								<input type="hidden" id="newVideo" name="newVideo" value="${(trainNewsInfo.newVideo)!}"/>
								<div class="control-group">
									<label class="control-label" for="form-field-1">咨询标题</label>
									<div class="controls">
										<input type="text" name="title" class="span10" id="form-field-1" placeholder="咨询标题" value="${(trainNewsInfo.title)!}">
									</div>
								</div>
								<div class="control-group">
									<label class="control-label" for="form-field-2">缩略图</label>
									<div class="controls">
										<input multiple type="file" id="id-input-file-3"/>
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="form-input-readonly">首页显示</label>
										<div class="controls" id="form-radio-show">
											<label class="span2">
												<input name="form-field-radio" type="radio" value="1"/><span class="lbl">显示</span>
											</label>
											<label class="span2">
												<input name="form-field-radio" checked="checked" type="radio" value="0"/><span class="lbl">不显示</span>
											</label>
										</div>
								</div>
								
								
								<div class="control-group">
									<label class="control-label" for="form-field-4">新闻视频</label>
									<div class="controls">
										<input type="file" name="uploadify" id="id-input-file"/>
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label" for="form-field-5">摘要内容</label>
									<div class="controls">
										<textarea name="subtract" class="span12" id="form-field-8" placeholder="摘要内容">${(trainNewsInfo.subtract)!}</textarea>
									</div>
								</div>
								
								<div class="control-group">
									<label class="control-label">咨询内容</label>
									<div class="controls">
										<script id="editor" type="text/plain" style="width:769px;height:300px;">${(trainNewsInfo.content)!}</script>
									</div>
								</div>
						
								<div class="form-actions">
									<button id='savebutton' class="btn btn-info" type="button"><i class="icon-ok"></i>保存</button>
									&nbsp; &nbsp; &nbsp;
									<button class="btn" type="reset" id="close"><i class="icon-undo"></i>关闭</button>
								<!-- 	<button id="resetbutton" class="btn" type="reset"><i class="icon-undo"></i>取消</button> -->
								</div>
							 </form>
							<!-- PAGE CONTENT ENDS HERE -->
						 </div><!--/row-->
					</div><!--/#page-content-->
			</div><!-- #main-content -->
		</div><!--/.fluid-container#main-container-->
		<a href="#" id="btn-scroll-up" class="btn btn-small btn-inverse">
			<i class="icon-double-angle-up icon-only"></i>
		</a>
		<!-- basic scripts -->
		<!-- <script src="${base}/static/1.9.1/jquery.min.js"></script> -->
		<script type="text/javascript">
		window.jQuery || document.write("<script src='${base}/static/js/jquery-1.9.1.min.js'>\x3C/script>");
		</script>
		
		<script src="${base}/static/js/bootstrap.min.js"></script>
		<!-- page specific plugin scripts -->
		
		<!--[if lt IE 9]>
		<script type="text/javascript" src="${base}/static/js/excanvas.min.js"></script>
		<![endif]-->
		<script type="text/javascript" src="${base}/static/js/jquery-ui-1.10.2.custom.min.js"></script>
		<script type="text/javascript" src="${base}/static/js/jquery.ui.touch-punch.min.js"></script>
		<script type="text/javascript" src="${base}/static/js/chosen.jquery.min.js"></script>
		<script type="text/javascript" src="${base}/static/js/fuelux.spinner.js"></script>
		<script type="text/javascript" src="${base}/static/js/bootstrap-datepicker.min.js"></script>
		<script type="text/javascript" src="${base}/static/js/bootstrap-timepicker.min.js"></script>
		<script type="text/javascript" src="${base}/static/js/date.js"></script>
		<script type="text/javascript" src="${base}/static/js/daterangepicker.min.js"></script>
		<script type="text/javascript" src="${base}/static/js/bootstrap-colorpicker.min.js"></script>
		<script type="text/javascript" src="${base}/static/js/jquery.autosize-min.js"></script>
		<script type="text/javascript" src="${base}/static/js/jquery.inputlimiter.1.3.1.min.js"></script>
		<!-- ace scripts -->
		<script src="${base}/static/js/ace-elements.min.js"></script>
		<script src="${base}/static/js/ace.min.js"></script>
		<!-- inline scripts related to this page -->

	<link href="${base}/plugins/umeditor1.2.2/themes/default/css/umeditor.css" type="text/css" rel="stylesheet">
    <script type="text/javascript" charset="utf-8" src="${base}/plugins/umeditor1.2.2/umeditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="${base}/plugins/umeditor1.2.2/umeditor.min.js"> </script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="${base}/plugins/umeditor1.2.2/lang/zh-cn/zh-cn.js"></script>	
		
		<!-- layer 弹出框处理 -->
		<script type="text/javascript" src="${base}/plugins/layer2.0/layer.js"></script>
		
		<script type="text/javascript">
		var um = UM.getEditor('editor');
		$(function() {
			$("#id-input-file").uploadify({
	            'uploader': '${base}/plugins/uploadify/uploadify.swf',
	            'script':"${base}/file/upload.htm;jsessionid=${sessionId!}",
	            'cancelImg': '${base}/plugins/uploadify/cancel.png',
	            'queueID': 'fileQueue',
	            'auto': true,
	            'buttonText': 'select',
	            'simUploadLimit' : 1,
	            'sizeLimit':1024*1024*10,
	            'queueSizeLimit' : 1,
	            'fileDesc' : 'video',
	            'fileExt': '*.flv',//格式*.gif,*.png
	            onComplete: function(event, queueID, fileObj, response, data) {
	                var dataObj = eval("("+response+")");
	                if(dataObj.status == 200){
	                	 console.log(dataObj.filePath);
	 					$("#newVideo").val(dataObj.filePath);
	                } else {
	                	layer.alert("对不起," + fileObj.name + "上传失败!<br/>请选择小于10M的flv格式的视频文件", {
		    				shade: [0.9, '#000'],
		    			    icon: 3,
		    			    time: 3000 //2秒关闭（如果不配置，默认是3秒）
		    			}); 
	                }
	            },
	            onSelect:function(){
	            },
	            onError: function(event, queueID, fileObj) {
	            	layer.alert("对不起," + fileObj.name + "上传失败!<br/>请选择小于10M的flv格式的视频文件", {
	    				shade: [0.9, '#000'],
	    			    icon: 3,
	    			    time: 3000 //2秒关闭（如果不配置，默认是3秒）
	    			}); 
	            }
	        });				
			
			$("#form-radio-show label input").on('click',function(){
				$("#marked").val($(this).val());
			});
			
			$("#resetbutton").on('click',function(){
				var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
				parent.layer.close(index);
			});			
			
			$("#savebutton").on('click',function(){
				var content = UM.getEditor('editor').getContent();
				var micro_pic = $("#id-input-file-3").parent().find("img:first").css("background-image");
				$("#content").val(content);
				$("#microPic").val(micro_pic);
				
				var ajaxParams = $("#submitForm").serialize();
				$.ajax({
					type : "POST",
					url : "${base}/sport/newsInfo/update.do",
					data : ajaxParams,
					datatype : "json",// "xml", "html", "script", "json", "jsonp", "text".
					beforeSend : function() {
						$("#msg").html("logining");
					},
					success : function(data) {// 成功返回之后调用的函数
						var jsondata = data;// eval('(' + data + ')');
						if(data.success){
							parent.layer.msg('保存成功', {
								shade: [0.9, '#000'],
							    icon: 6,
							    time: 1500 //2秒关闭（如果不配置，默认是3秒）
							}, function(){
								parent.reload_page();
								var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
								parent.layer.close(index);
							}); 							
						}else{
							parent.layer.msg('保存出错', {
								shade: [0.9, '#000'],
							    icon: 6,
							    time: 1500 //2秒关闭（如果不配置，默认是3秒）
							}, function(){
							}); 	
						}
						//console.log(data.success);
					},
					complete : function(XMLHttpRequest, textStatus) {// 调用执行后调用的函数
						
					},
					error : function() {// 调用出错执行的函数
					}
				});
			});
							
			$('#id-input-file-1 , #id-input-file-2').ace_file_input({
				no_file:'No File ...',
				btn_choose:'Choose',
				btn_change:'Change',
				droppable:false,
				onchange:null,
				thumbnail:false //| true | large
				//whitelist:'gif|png|jpg|jpeg'
				//blacklist:'exe|php'
				//onchange:''
				//
			});
			
			$('#id-input-file-3').ace_file_input({
				style:'well',
				btn_choose:'点击上传图片文件',
				btn_change:null,
				no_icon:'icon-cloud-upload',
				droppable:true,
				onchange:null,
				thumbnail:'small',
				before_change:function(files, dropped) {
					//console.log(files);
					//console.log(dropped);
					/**
					if(files instanceof Array || (!!window.FileList && files instanceof FileList)) {
						//check each file and see if it is valid, if not return false or make a new array, add the valid files to it and return the array
						//note: if files have not been dropped, this does not change the internal value of the file input element, as it is set by the browser, and further file uploading and handling should be done via ajax, etc, otherwise all selected files will be sent to server
						//example:
						var result = []
						for(var i = 0; i < files.length; i++) {
							var file = files[i];
							if((/^image\//i).test(file.type) && file.size < 102400)
								result.push(file);
						}
						return result;
					}
					*/
					return true;
				}
				/*,
				before_remove : function() {
					return true;
				}*/
			}).on('change', function(){
				//console.log($(this).data('ace_input_files'));
				//console.log($(this).data('ace_input_files'));
				//console.log($(this).data('ace_input_method'));
			});
			
			
		});
		$('#close').click(function(){
			var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
			parent.layer.close(index);
		});
		</script>
	</body>
</html>
