<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Form Elements - Ace Admin</title>
    <meta name="description" content="Common form elements and layouts"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <#include "../../common/head.htm"/>
    <link href="${base}/static/css/course.css" rel="stylesheet" type="text/css"/>
    <link href="${base}/plugins/uploadify/uploadify.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="${base}/plugins/uploadify/swfobject.js"></script>
    <script type="text/javascript" src="${base}/plugins/uploadify/jquery.uploadify.v2.1.4.min.js"></script>
</head>
<body>
<div class="container-fluid" id="main-container">
    <div id="main-content" class="clearfix" style="margin-left:0px;">
        <div id="page-content" class="clearfix">
            <div class="row-fluid">
                <!-- PAGE CONTENT BEGINS HERE -->
                <form id="submitForm" class="form-horizontal" method="POST">
                    <input type="hidden" name="matchId" value="${(matchId)!}"/>
                    <input type="hidden" name="teamId" value="${(teamId)!}"/>
                    <table id="table_bug_report" class="table table-striped table-bordered table-hover">
                        <thead>
                        <tr>
                            <th class='center'>球员</th>
                            <th class='center'>上场时间</th>
                            <th class='center'>类型</th>
                            <th class='center'>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <#if hotDatas??>
                            <#list hotDatas as hot>
                                <tr>
                                    <td class='center'>
                                        <input type="hidden" name="id" value="${(hot.id)!}"/>
                                        <select name="playerId" class="input-small">
                                            <#if players??>
                                                <#list players as player>
                                                    <option <#if hot.playerId == player.id>selected='true'</#if> value="${(player.id)!}">${(player.name)!}</option>
                                                </#list>
                                            </#if>
                                        </select>
                                    </td>
                                    <td class='center'>
                                        <input class="input-mini input-mask-eyescript" type="text" name="minute" value="${(hot.minute)!}"/>
                                    </td>
                                    <td class='center'>
                                        <select name="type" class="input-small">
                                            <#if hotTypes??>
                                                <#list hotTypes as ht>
                                                    <option <#if hot.type == ht.getStatus()>selected='true'</#if> value="${(ht.getStatus())!}">${(ht.getValue())!}</option>
                                                </#list>
                                            </#if>
                                        </select>
                                    </td>
                                    <td class='center'>
                                        <a id="add_hot" class="btn btn-mini btn-info"><i class='icon-plus'></i></a>
                                        <a id="del_hot" class="btn btn-mini btn-danger"><i class='icon-trash'></i></a>
                                    </td>
                                </tr>
                            </#list>
                            <#else>
                                <tr>
                                    <td class='center'>
                                        <select name="playerId" class="input-small">
                                            <#if players??>
                                                <#list players as player>
                                                    <option value="${(player.id)!}">${(player.name)!}</option>
                                                </#list>
                                            </#if>
                                        </select>
                                    </td>
                                    <td class='center'>
                                        <input class="input-mini input-mask-eyescript" type="text" name="minute"/>
                                    </td>
                                    <td class='center'>
                                        <select name="type" class="input-small">
                                            <#if hotTypes??>
                                                <#list hotTypes as ht>
                                                    <option  value="${(ht.getStatus())!}">${(ht.getValue())!}</option>
                                                </#list>
                                            </#if>
                                        </select>
                                    </td>
                                    <td class='center'>
                                        <a id="add_hot" class="btn btn-mini btn-info"><i class='icon-plus'></i></a>
                                        <a id="del_hot" class="btn btn-mini btn-danger"><i class='icon-trash'></i></a>
                                    </td>
                                </tr>
                        </#if>
                        </tbody>
                    </table>

                    <div class="form-actions">
                        <button id='cancel-button' class="btn btn-small" style="float:right;" type="reset"><i
                                class="icon-undo"></i>关闭
                        </button>
                        <button id='savebutton' class="btn btn-small btn-primary"
                                style="float:right; margin-right:20px;" type="button"><i class="icon-ok"></i>确认
                        </button>
                    </div>
                </form>
                <!-- PAGE CONTENT ENDS HERE -->
            </div><!--/row-->
        </div><!--/#page-content-->
    </div><!-- #main-content -->
</div><!--/.fluid-container#main-container-->
<a href="#" id="btn-scroll-up" class="btn btn-small btn-inverse">
    <i class="icon-double-angle-up icon-only"></i>
</a>
<!-- basic scripts -->
<!-- <script src="${base}/static/1.9.1/jquery.min.js"></script> -->
<script type="text/javascript">
    window.jQuery || document.write("<script src='${base}/static/js/jquery-1.9.1.min.js'>\x3C/script>");
</script>

<script src="${base}/static/js/bootstrap.min.js"></script>
<!-- page specific plugin scripts -->

<!--[if lt IE 9]>
<script type="text/javascript" src="${base}/static/js/excanvas.min.js"></script>
<![endif]-->
<script type="text/javascript" src="${base}/static/js/jquery-ui-1.10.2.custom.min.js"></script>
<script type="text/javascript" src="${base}/static/js/jquery.ui.touch-punch.min.js"></script>
<script type="text/javascript" src="${base}/static/js/chosen.jquery.min.js"></script>
<script type="text/javascript" src="${base}/static/js/fuelux.spinner.js"></script>
<script type="text/javascript" src="${base}/static/js/bootstrap-datepicker.min.js"></script>
<script type="text/javascript" src="${base}/static/js/bootstrap-timepicker.min.js"></script>
<script type="text/javascript" src="${base}/static/js/date.js"></script>
<script type="text/javascript" src="${base}/static/js/daterangepicker.min.js"></script>
<script type="text/javascript" src="${base}/static/js/bootstrap-colorpicker.min.js"></script>
<script type="text/javascript" src="${base}/static/js/jquery.autosize-min.js"></script>
<script type="text/javascript" src="${base}/static/js/jquery.inputlimiter.1.3.1.min.js"></script>
<script type="text/javascript" src="${base}/static/js/jquery.maskedinput.min.js"></script>
<!-- ace scripts -->
<script src="${base}/static/js/ace-elements.min.js"></script>
<script src="${base}/static/js/ace.min.js"></script>
<!-- inline scripts related to this page -->
<!-- 日期框 -->
<script type="text/javascript" src="${base}/static/js/bootbox.min.js"></script>
<!-- layer 弹出框处理 -->
<script type="text/javascript" src="${base}/plugins/layer2.0/layer.js"></script>
<script type="text/javascript">
    var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
    function eachDatas(obj){
        obj.find('input').each(function(a,b){
            clear(b);
        });
        obj.find('select').each(function(a,b){
            clear(b);
        });
    }

    function clear(obj){
        $(obj).val('');
    }

    // 生成数字插件
    function createAceSpinner(obj, value, max){
        $(obj).ace_spinner({value:value,min:0,max:max,step:1, icon_up:'icon-plus', icon_down:'icon-minus', btn_up_class:'btn-success' , btn_down_class:'btn-danger'});
    }

    $(function () {
        // 添加
        $('.center #add_hot').live("click", function(){
            var _tr = $(this).parent().parent();
            var _table = _tr.parent();
            var _clone = _tr.clone();
            eachDatas(_clone);
            _table.append(_clone)
        });

        //删除
        $('.center #del_hot').live("click", function(){
            var _tr = $(this).parent().parent();
            var _table = _tr.parent();
            var len = _table.children("tr").length;
            if (len == 1){
                layer.alert('亲,至少给我留一个~', { icon: 7 });
                return;
            }
            _tr.remove();
        });

        $.mask.definitions['~']='[+-]';
        $('.input-mask-eyescript').mask('99');

        //关闭iframe
        $('#cancel-button').click(function () {
            parent.layer.close(index);
        });

        $(".chzn-select").chosen();

        $("#savebutton").on('click', function () {
            submit();
        });
    });

    function submit() {
        var minutes = $('[name=minute]');
        var flag = false;
        minutes.each(function(i){
            if ((null == $(this).val() || $(this).val() == '') && $(this).attr("disabled") != 'disabled'){
                layer.alert('第'+(i+1)+'条上场时间没有填写~', { icon: 7 });
                flag = true;
                return;
            }
        });
        if (flag) return;

        var ajaxParams = $("#submitForm").serialize();
        $.ajax({
            type : "POST",
            url : "${base}/competition/match/saveHotDatas.do",
            data : ajaxParams,
            datatype : "json",// "xml", "html", "script", "json", "jsonp", "text".
            beforeSend : function() {
            },
            success : function(data) {// 成功返回之后调用的函数
                var jsondata = null;//eval('(' + data + ')');
                if (data instanceof Object){
                    jsondata = data;
                }else{
                    jsondata = eval('(' + data + ')');
                }
                if(jsondata.status == 200){
                    parent.layer.msg(jsondata.message, {
                        shade: [0.9, '#000'],
                        icon: 6,
                        time: 1500 //2秒关闭（如果不配置，默认是3秒）
                    }, function(){
                        //parent.reload_page();
                        parent.layer.close(index);
                    });
                }else{
                    parent.layer.msg(jsondata.message, {
                        shade: [0.9, '#000'],
                        icon: 6,
                        time: 1500 //2秒关闭（如果不配置，默认是3秒）
                    }, function(){
                    });
                }
                //console.log(data.success);
            },
            complete : function(XMLHttpRequest, textStatus) {// 调用执行后调用的函数

            },
            error : function() {// 调用出错执行的函数
            }
        });
    }
</script>
</body>
</html>
